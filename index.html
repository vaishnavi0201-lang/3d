<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chutki 360 Viewer | Premium v1.0</title>
    <style>
        :root {
            --primary: #FFD700;
            --secondary: #FF4560;
            --bg-glass: rgba(255, 255, 255, 0.2);
            --border-glass: rgba(255, 255, 255, 0.3);
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: radial-gradient(circle at center, #ffffff 0%, #f0f0f0 100%);
            font-family: var(--font-main);
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Loading Screen */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* UI Controls */
        .ui-overlay {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            padding: 15px 30px;
            background: var(--bg-glass);
            backdrop-filter: blur(15px);
            border-radius: 50px;
            border: 1px solid var(--border-glass);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .control-btn {
            background: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            color: #333;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .control-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: var(--primary);
            color: white;
        }

        .control-btn.active {
            background: var(--secondary);
            color: white;
        }

        .title-card {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 10;
            pointer-events: none;
        }

        .title-card h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(45deg, #FFD700, #FF4560);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .title-card p {
            margin: 5px 0 0;
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #error-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff0f0;
            color: #d00;
            padding: 20px;
            border-radius: 10px;
            display: none;
            text-align: center;
            z-index: 2000;
        }
    </style>
</head>

<body>

    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: #666;">Duck...</p>
    </div>

    <div id="error-msg">
        <h3>Oops! Loading Failed</h3>
        <p id="error-detail">Could not load the 3D model. Please check the URL or try again.</p>
        <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 15px;">Retry</button>
    </div>

    <div class="title-card">
        <h1>Duck</h1>
        <p>Interactive 360&deg; Experience</p>
    </div>

    <div class="ui-overlay">
        <button class="control-btn" id="rotate-btn" title="Auto Rotate">üîÑ</button>
        <button class="control-btn" id="zoom-in" title="Zoom In">+</button>
        <button class="control-btn" id="zoom-out" title="Zoom Out">-</button>
        <button class="control-btn" id="reset-btn" title="Reset View">üè†</button>
        <button class="control-btn" id="fullscreen-btn" title="Full Screen">‚õ∂</button>
    </div>

    <div id="canvas-container"></div>

    <!-- Three.js CDN -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        let scene, camera, renderer, controls, model;
        let isAutoRotating = true;

        const loaderElement = document.getElementById('loader');
        const container = document.getElementById('canvas-container');

        // CHUTKI MODEL CONFIGURATION
        // REPLACE THIS URL with your actual Chutki GLB file URL
        const MODEL_URL = 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb';

        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = null; // Transparent background (radial gradient in CSS)

            // Camera
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.5, 5);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            container.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(5, 10, 7);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Ground Reflective Shadow (Subtle)
            const shadowPlane = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.ShadowMaterial({ opacity: 0.1 })
            );
            shadowPlane.rotation.x = -Math.PI / 2;
            shadowPlane.position.y = -1;
            shadowPlane.receiveShadow = true;
            scene.add(shadowPlane);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 2;
            controls.maxDistance = 10;
            controls.autoRotate = isAutoRotating;
            controls.autoRotateSpeed = 2.0;

            // Model Loading
            const loader = new GLTFLoader();
            loader.load(
                MODEL_URL,
                function (gltf) {
                    model = gltf.scene;

                    // Center and scale model
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());

                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 2 / maxDim; // Scale to fit roughly in 2 units
                    model.scale.setScalar(scale);

                    model.position.sub(center.multiplyScalar(scale));
                    model.position.y = -0.5; // Offset to sit on "ground"

                    model.traverse(node => {
                        if (node.isMesh) {
                            node.castShadow = true;
                            node.receiveShadow = true;
                            // If it's a generic model, we could apply Chutki-like colors here
                            // but for a GLB we usually keep textures.
                        }
                    });

                    scene.add(model);
                    loaderElement.style.opacity = '0';
                    setTimeout(() => loaderElement.style.display = 'none', 500);
                },
                function (xhr) {
                    const percent = (xhr.loaded / xhr.total * 100);
                    console.log('Progress:', percent + '%');
                },
                function (error) {
                    console.error('Error loading model:', error);
                    document.getElementById('error-msg').style.display = 'block';
                    loaderElement.style.display = 'none';
                }
            );

            // UI Listeners
            document.getElementById('rotate-btn').addEventListener('click', (e) => {
                isAutoRotating = !isAutoRotating;
                controls.autoRotate = isAutoRotating;
                e.target.classList.toggle('active', isAutoRotating);
            });
            document.getElementById('rotate-btn').classList.toggle('active', isAutoRotating);

            document.getElementById('zoom-in').addEventListener('click', () => {
                camera.position.z -= 0.5;
            });

            document.getElementById('zoom-out').addEventListener('click', () => {
                camera.position.z += 0.5;
            });

            document.getElementById('reset-btn').addEventListener('click', () => {
                controls.reset();
                camera.position.set(0, 1.5, 5);
            });

            document.getElementById('fullscreen-btn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            });

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>